function initViewModel(){var a={foursquareVenues:ko.observableArray([]),foursquareVenuesList:ko.observableArray([foursquareVenues]),markerList:ko.observableArray([allMarkers]),query:ko.observable(""),foursquareVenuesFilter:ko.observable(),userAddress:ko.observable(),foursquareVenueNames:[],venuePrice:ko.observable(),foursquareLocation:ko.observable(),googleDirections:ko.observable(),foursquareWebsite:ko.observable(),foursquareURL:ko.observable(),foursquareContact:ko.observable(),foursquareStatus:ko.observable(),foursquareRating:ko.observable(),foursquareNoVenue:ko.observable(),foursquareError:ko.observable(!1),infoWindowNode:document.getElementById("infoWindowNode"),index:ko.observable(),venueName:ko.observable(),listContainer:document.getElementById("list-container"),openNavButton:document.getElementById("open-nav"),closeNavButton:document.getElementById("close-nav"),searchSection:document.getElementById("search-section"),filterBtn:document.getElementById("filter-btn"),closeFilterBtn:document.getElementById("close-filter-btn"),introSearchInput:ko.observable(""),fetch:function(a){return fetch(a)},getJSON:function(b){return a.fetch(b).then(function(a){return a.json()})},findLocation:function(){function c(c){var d=c.coords.latitude,e=c.coords.longitude;fetch("https://maps.googleapis.com/maps/api/geocode/json?latlng="+d+","+e+"&key=AIzaSyDstwW4Ea6RJFKBuw2hj2kHXAcFioor_2o").then(function(a){return a.json()}).then(function(c){var d=c.results[0].formatted_address.search(", USA");a.introSearchInput(c.results[0].formatted_address.substring(0,d)),b.val(a.introSearchInput())})}function d(){alert("Sorry; we couldn't find your location. Please make sure your location services (GPS) are enabled.")}if(navigator.geolocation){var b=$("#intro-search-input");navigator.geolocation.getCurrentPosition(c,d,{enableHighAccuracy:!0,timeout:3e4,maximumAge:0})}},introSearch:function(){userCity=a.introSearchInput();var b="https://api.foursquare.com/v2/venues/explore?near="+a.introSearchInput()+"&section=food&limit=50&client_id=2DV1P3YPGYBLCEXLTRGNBKZR2EHZINKEHVET2TCUFQFQ23KS&client_secret=EFDTVXXZJSBEVC12RAMZBV24RFUDEY3E1CG2USRDT0NWEK1A&v=20170101&m=foursquare";a.getJSON(b).then(function(b){var c=b.response.groups[0].items;c.forEach(function(a){foursquareVenues.push(a.venue)}),a.initMap(),function(){foursquareVenues.forEach(function(b){a.foursquareVenues.push(b)})}(),a.userAddress(userCity),a.venueNames()}).then(function(){!function(){var a=document.getElementById("intro-search-container");a.style.opacity="0";setTimeout(function(){a.style.display="none"},1e3)}()})["catch"](function(){alert("Sorry; the Foursquare servers could not be reached.")})},initMap:function(){geocoder=new google.maps.Geocoder;var c,b={lat:37.3036,lng:-121.8974};c=$(window).width()<=768?11:14,map=new google.maps.Map(document.getElementById("map-container"),{center:b,zoom:c,mapTypeControl:!1}),geocoder&&geocoder.geocode({address:userCity},function(a,b){b==google.maps.GeocoderStatus.OK&&b!==google.maps.GeocoderStatus.ZERO_RESULTS&&(map.setCenter(a[0].geometry.location),userCityGeocode=a[0].geometry.location)}),a.createMarkers(),google.maps.event.addDomListener(window,"resize",function(){map.setCenter(userCityGeocode)})},createMarkers:function(){foursquareVenues.forEach(function(b){function d(){a.venueName(c.title),$("#modal1").openModal()}function e(){var a=new google.maps.LatLng(b.coordinates.lat,b.coordinates.lng);map.panTo(a)}function f(){a.index(foursquareVenues.indexOf(b))}function g(){c.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){c.setAnimation(null)},1400)}b.coordinates={lat:b.location.lat,lng:b.location.lng};var c=new google.maps.Marker({position:b.coordinates,map:map,title:b.name,animation:google.maps.Animation.DROP});allMarkers.push(c),c.addListener("click",function(){f(),a.closeFilterOnSelect(),e(),g(),d(),a.getFourSquare()})})},openInfoWindow:function(b){function d(){var c=new google.maps.LatLng(a.foursquareVenues()[b].location.lat,a.foursquareVenues()[b].location.lng);map.panTo(c)}a.index(b),a.closeFilterOnSelect(),a.venueName(a.foursquareVenues()[b].name);var c=a.foursquareVenueNames.indexOf(a.venueName());a.getFourSquare(),d(),allMarkers[c].setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){allMarkers[c].setAnimation(null)},1400),a.closeNavOnSelect(),$("#modal1").openModal()},getFourSquare:function(){var b=a.foursquareVenues()[a.index()].id,c="https://api.foursquare.com/v2/venues/"+b+"?client_id=2DV1P3YPGYBLCEXLTRGNBKZR2EHZINKEHVET2TCUFQFQ23KS&client_secret=EFDTVXXZJSBEVC12RAMZBV24RFUDEY3E1CG2USRDT0NWEK1A&v=20170101&m=foursquare";a.getJSON(c).then(function(b){var c=b.response.venue;c.attributes.groups[0].summary?a.venuePrice(c.attributes.groups[0].summary):a.venuePrice("Price info is not available for this location."),void 0!==c.location.address&&void 0!==c.location.city&&void 0!==c.location.state?a.foursquareLocation(c.location.address+" "+c.location.city+", "+c.location.state):a.foursquareLocation("Address is not available");var d;d="Address is not available"===a.foursquareLocation()?null:"http://maps.google.com/maps?saddr="+userCity+"&daddr="+c.location.address+c.location.city+c.location.state,null!==d?a.googleDirections(d):a.googleDirections(null),c.url?a.foursquareURL(c.url):a.foursquareURL(null),c.contact.formattedPhone?a.foursquareContact(c.contact.formattedPhone):a.foursquareContact("Phone number not avaialable"),c.hours?a.foursquareStatus(c.hours.status):a.foursquareStatus("Open/Closed Status Not Available"),void 0!==c.rating?a.foursquareRating(c.rating):a.foursquareRating("No Rating Avaialable"),c.ratingColor?$("#foursquare-rating").css({background:"#"+c.ratingColor}):$("#foursquare-rating").css({background:"#fff"})})["catch"](function(){a.foursquareError(!0),a.venuePrice(""),a.foursquareLocation(""),a.googleDirections(""),a.foursquareURL("#"),a.foursquareContact(""),a.foursquareStatus(""),a.foursquareRating(""),$("#foursquare-rating").css({background:"#fff"}),alert("Foursquare could not be reached at this time.")})},venueNames:function(){foursquareVenues.forEach(function(b){a.foursquareVenueNames.push(b.name)})},stopRefreshOnEnter:$(function(){$("form").submit(function(){return!1})}),subscribeToSearch:function(){a.query.subscribe(a.search)},search:function(b){allMarkers.forEach(function(a){a.setVisible(!1)}),allMarkers.forEach(function(a){a.title.toLowerCase().indexOf(b.toLowerCase())>=0&&a.setVisible(!0)}),a.foursquareVenues.removeAll(),foursquareVenues.forEach(function(c){(c.categories[0].name.toLowerCase().indexOf(b.toLowerCase())>=0||c.name.toLowerCase().indexOf(b.toLowerCase())>=0)&&a.foursquareVenues.push(c)})},openNav:function(){a.listContainer.style.zIndex="2",a.listContainer.style.opacity="1",a.openNavButton.style.display="none",a.closeNavButton.style.display="block",a.searchSection.style.zIndex="3",a.searchSection.style.opacity="1"},closeNav:function(){a.listContainer.style.zIndex="0",a.listContainer.style.opacity="0",a.searchSection.style.zIndex="0",a.searchSection.style.opacity="0",a.closeNavButton.style.display="none",a.openNavButton.style.display="block"},closeNavOnSelect:function(){$(window).width()<=1e3&&a.closeNav()},openFilter:function(){a.searchSection.style.top="50px",a.filterBtn.style.display="none",a.closeFilterBtn.style.display="inline-block"},openFilterOnSelect:function(){$(window).width()>1e3&&a.openFilter()},closeFilter:function(){a.searchSection.style.top="-200px",a.filterBtn.style.display="inline-block",a.closeFilterBtn.style.display="none"},closeFilterOnSelect:function(){$(window).width()>1e3&&a.closeFilter()}};ko.applyBindings(a),a.findLocation(),a.subscribeToSearch()}
